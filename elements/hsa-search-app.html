<link rel="import" href="../bower_components/polymer/polymer.html">
<link rel="import" href="../bower_components/iron-flex-layout/iron-flex-layout.html">
<link rel="import" href="../bower_components/iron-icons/iron-icons.html">
<link rel="import" href="../bower_components/iron-list/iron-list.html">
<link rel="import" href="../bower_components/iron-ajax/iron-ajax.html">
<link rel="import" href="../bower_components/paper-toolbar/paper-toolbar.html">
<link rel="import" href="../bower_components/paper-input/paper-input.html">
<link rel="import" href="../elements/hsa-item.html">
<dom-module id="hsa-search-app">
	<template>
		<style>
			:root {
				--default-primary-color: var(--paper-amber-900);
			}
			
			:host {
				@apply(--layout-fit);
				@apply(--layout-vertical);
				@apply(--paper-font-common-base);
				background-color: var(--paper-amber-50);
			}
			
			iron-list {
				flex: 1 100%;
				overflow-y: scroll;
				--iron-list-items-container: {
					max-width: 960px;
					margin: 45px auto;
				}
				;
			}
			
			paper-toolbar {
				--paper-toolbar-background: var(--paper-amber-100);
				@apply(--shadow-elevation-6dp);
				z-index: 1;
			}
			
			paper-input {
				max-width: 960px;
				min-width: 240px;
				width: 100%;
				margin: 30px auto 5px auto;
				--paper-input-container-label: {
					font-size: 24px;
					line-height: 36px;
				}
				;
				--paper-input-container-input: {
					font-size: 24px;
					line-height: 36px;
				}
				;
			}
			paper-input.floated-label-placeholder {
				font-size: 14px;
			}

		</style>

		<paper-toolbar class="tall">
			<paper-input autofocus label="Sök vårdenhet" value={{criteria::input}} minlength="3" error-message="(ange minst tre tecken)" auto-validate="true"></paper-input>
		</paper-toolbar>
		<iron-ajax auto="[[isActive(criteria)]]" url="http://cloud.medicor.se:3148/catalogs/hsa" params="[[getQuery(criteria)]]" last-response="{{items}}" debounce-duration="300"></iron-ajax>
		<iron-list id="list" items="[[items]]" as="item">
			<template>
				<hsa-item model="[[item]]"></hsa-item>
			</template>
		</iron-list>

	</template>

	<script>
		HTMLImports.whenReady(function() {
			Polymer({
				is: 'hsa-search-app',
				properties: {
					items: {
						type: Array
					},
					criteria: {
						type: String
					},
				},
				isActive: function(aCriteria) {
					return aCriteria.length >= 3;
				},
				getQuery: function(aCriteria) {
					return {"query": '{\"dn\":{\"$regex\":\"' +  aCriteria + '\", \"$options\":\"ig\"}}'};
				}
			});
		});
	</script>

</dom-module>